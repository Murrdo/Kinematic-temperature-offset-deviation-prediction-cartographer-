[gcode_macro TEMP_SHAKE]
description: Micro vibration around current position (X then Y)
gcode:
    {% set DIST = params.DIST|default(7)|float %}
    {% set PASSES = params.PASSES|default(20)|int %}
    {% set ACCEL = params.ACCEL|default(25000)|int %}
    {% set SPEED = params.SPEED|default(700)|int %}
	{% set SCV = params.SCV|default(25)|int %}
	{% set CRUISE = params.CRUISE|default(0)|int %}
	{% set CUR_POS = params.CUR_POS|default(0)|int %}

	{% if printer.toolhead.position.z <2 %}
		G1 Z3 F{60*60}
	{% endif %}
	
	{% if CUR_POS == 0 %}
		G1 X205 F{500*60}
	{% endif %}

    SET_VELOCITY_LIMIT ACCEL={ACCEL} 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={SCV}
	SET_VELOCITY_LIMIT MINIMUM_CRUISE_RATIO={CRUISE}

    G1 F{SPEED*60}

    G91
    {% for i in range(PASSES) %}
        G1 X{DIST}
        G1 X-{DIST}
    {% endfor %}

    {% for i in range(PASSES) %}
        G1 Y{DIST}
        G1 Y-{DIST}
    {% endfor %}
    G90

    SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel} 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity} 
	SET_VELOCITY_LIMIT MINIMUM_CRUISE_RATIO={printer.configfile.settings.printer.minimum_cruise_ratio}